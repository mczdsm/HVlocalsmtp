version: '3.8'

services:
  smtp-receiver:
    build: .
    container_name: smtp-receiver-app
    ports:
      - "1025:1025"
    volumes:
      # Mount the named volume to the path the application expects.
      # The app writes to /scans/users, so we mount the volume at /scans.
      - scan_data:/scans
    environment:
      # LOGGING_MODE: 'DEBUG' or 'PRODUCTION'.
      # - DEBUG: Verbose console logging.
      # - PRODUCTION: Separates audit and error logs into files.
      - LOGGING_MODE=DEBUG
      # TEST_MODE: 'true' or 'false'.
      # - true: Enables automatic sending of test emails to the server.
      - TEST_MODE=true
    restart: unless-stopped

  webdav:
    image: bytemark/webdav:latest
    container_name: webdav-server
    environment:
      - AUTH_TYPE=Basic
      # IMPORTANT: Replace 'YourStrongPassword' with a secure password.
      - USERNAME=webdavuser
      - PASSWORD=YourStrongPassword
    ports:
      - "80:80"
    volumes:
      # Mount the named volume to the path that the WebDAV server uses.
      - scan_data:/var/lib/dav
    restart: unless-stopped

volumes:
  scan_data:
    driver: local
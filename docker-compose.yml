version: '3.8'

services:
  smtp-receiver:
    build: .
    container_name: smtp-receiver-app
    ports:
      - "1025:1025"
    volumes:
      # Mount the named volume to the path the application expects.
      # The app writes to /scans/users, so we mount the volume at /scans.
      - scan_data:/scans
    environment:
      # LOGGING_MODE: 'DEBUG' or 'PRODUCTION'.
      # - DEBUG: Verbose console logging.
      # - PRODUCTION: Separates audit and error logs into files.
      - LOGGING_MODE=DEBUG
      # TEST_MODE: 'true' or 'false'.
      # - true: Enables automatic sending of test emails to the server.
      - TEST_MODE=true
    restart: unless-stopped

  webdav:
    image: bytemark/webdav
    container_name: webdav-server
    ports:
      - "80:80" # Expose port 80 for HTTP WebDAV access
    environment:
      # IMPORTANT: Replace 'webuser' and 'YourWebDAVPassword' with secure credentials.
      - USERNAME=webuser
      - PASSWORD=YourWebDAVPassword
    volumes:
      # Mount the named volume to the default WebDAV data directory.
      - scan_data:/var/lib/dav
    restart: unless-stopped

volumes:
  scan_data:
    driver: local
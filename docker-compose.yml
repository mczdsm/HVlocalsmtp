version: '3.8'

services:
  smtp-receiver:
    build: .
    container_name: smtp-receiver-app
    ports:
      - "1025:1025"
    volumes:
      # Mount the named volume to the path the application expects.
      # The app writes to /scans/users, so we mount the volume at /scans.
      - scan_data:/scans
    environment:
      # LOGGING_MODE: 'DEBUG' or 'PRODUCTION'.
      # - DEBUG: Verbose console logging.
      # - PRODUCTION: Separates audit and error logs into files.
      - LOGGING_MODE=DEBUG
      # TEST_MODE: 'true' or 'false'.
      # - true: Enables automatic sending of test emails to the server.
      - TEST_MODE=false
    restart: unless-stopped

  samba:
    image: dperson/samba:latest
    container_name: samba-server
    # IMPORTANT: Replace 'YourStrongPassword' with a secure password.
    environment:
      - USER=winuser;YourStrongPassword;;filemanagers;1001
      - GROUP=filemanagers;1001
      # Defines a share named 'scans' that points to the /srv/scans directory inside this container.
      - SHARE=scans;/srv/scans;yes;no;no;@filemanagers
      # Force shares to be writable as a global option
      - SAMBA_GLOBAL_OPTIONS=writable = yes
    ports:
      - "139:139"
      - "445:445"
    volumes:
      # Mount the named volume to the path that the SHARE variable uses.
      - scan_data:/srv/scans
    restart: unless-stopped

volumes:
  scan_data:
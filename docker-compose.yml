version: '3.8'

services:
  smtp-receiver:
    build: .
    container_name: smtp-receiver-app
    ports:
      - "1025:1025"
    volumes:
      # Mount the named volume to the path the application expects.
      # The app writes to /scans/users, so we mount the volume at /scans.
      - scan_data:/scans
    environment:
      # LOGGING_MODE: 'DEBUG' or 'PRODUCTION'.
      # - DEBUG: Verbose console logging.
      # - PRODUCTION: Separates audit and error logs into files.
      - LOGGING_MODE=DEBUG
      # TEST_MODE: 'true' or 'false'.
      # - true: Enables automatic sending of test emails to the server.
      - TEST_MODE=true
    restart: unless-stopped

  samba:
    image: ghcr.io/servercontainers/samba:latest
    container_name: samba-server
    # IMPORTANT: Replace 'YourStrongPassword' with a secure password.
    environment:
      - ACCOUNT_winuser=YourStrongPassword
      - UID_winuser=1001
      - GROUP_filemanagers=1001
      - GROUPS_winuser=filemanagers
      - SAMBA_VOLUME_CONFIG_scans=[scans];path=/srv/scans;browseable=yes;read only=no;guest ok=no;valid users=@filemanagers;create mask=0664;directory mask=0755;force user=1001;force group=1001
    ports:
      - "139:139"
      - "445:445"
    volumes:
      # Mount the named volume to the path that the SHARE variable uses.
      - scan_data:/srv/scans
    restart: unless-stopped

volumes:
  scan_data:
    driver: local